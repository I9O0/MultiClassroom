<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>教室查询接口测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .container { border: 1px solid #ccc; padding: 20px; border-radius: 5px; }
        .result { margin-top: 20px; padding: 10px; border-radius: 5px; }
        .success { background-color: #dff0d8; border: 1px solid #d6e9c6; }
        .error { background-color: #f2dede; border: 1px solid #ebccd1; }
        .debug { margin-top: 10px; padding: 10px; background-color: #f5f5f5; font-family: monospace; }
        button { padding: 8px 16px; background-color: #428bca; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #3071a9; }
    </style>
</head>
<body>
    <div class="container">
        <h2>教室查询接口测试</h2>
        <div>
            <label>后端API地址地址：</label>
            <input type="text" id="apiUrl" value="http://localhost:8080/classroom/list" style="width: 500px;">
        </div>
        <br>
        <div>
            <label>查询参数：</label>
            <pre>identity=stu&buildingId=J1&queryDate=2025-10-30</pre>
        </div>
        <br>
        <button onclick="testConnection()">测试连接</button>
        
        <div id="result" class="result" style="display: none;"></div>
        <div id="debug" class="debug" style="display: none;"></div>
    </div>

    <script>
        function testConnection() {
            const resultDiv = document.getElementById('result');
            const debugDiv = document.getElementById('debug');
            const apiUrl = document.getElementById('apiUrl').value;
            
            // 构建完整请求URL
            const fullUrl = `${apiUrl}?identity=stu&buildingId=J1&queryDate=2025-10-30`;
            
            // 重置显示
            resultDiv.style.display = 'block';
            debugDiv.style.display = 'block';
            resultDiv.innerHTML = '正在请求...';
            debugDiv.innerHTML = `请求URL: ${fullUrl}\n\n`;
            
            // 创建XHR对象（最基础的HTTP请求方式）
            const xhr = new XMLHttpRequest();
            xhr.open('GET', fullUrl, true);
            xhr.timeout = 10000; // 10秒超时
            
            // 监听请求状态变化
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    // 记录调试信息
                    debugDiv.innerHTML += `状态码: ${xhr.status}\n`;
                    debugDiv.innerHTML += `响应头: ${xhr.getAllResponseHeaders()}\n\n`;
                    debugDiv.innerHTML += `响应内容: ${xhr.responseText}\n`;
                    
                    if (xhr.status === 200) {
                        try {
                            // 尝试解析JSON
                            const response = JSON.parse(xhr.responseText);
                            resultDiv.className = 'result success';
                            resultDiv.innerHTML = `
                                <h3>请求成功</h3>
                                <p>响应状态码: ${xhr.status}</p>
                                <p>返回教室数量: ${response.data ? response.data.length : 0}</p>
                            `;
                        } catch (e) {
                            resultDiv.className = 'result error';
                            resultDiv.innerHTML = `
                                <h3>解析响应失败</h3>
                                <p>服务器返回了数据，但格式不是有效的JSON</p>
                            `;
                        }
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `
                            <h3>请求失败</h3>
                            <p>响应状态码: ${xhr.status}</p>
                            <p>状态文本: ${xhr.statusText}</p>
                        `;
                    }
                }
            };
            
            // 处理超时
            xhr.ontimeout = function() {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>请求超时</h3><p>服务器在10秒内没有响应</p>';
                debugDiv.innerHTML += '错误: 请求超时\n';
            };
            
            // 处理网络错误
            xhr.onerror = function() {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = '<h3>网络错误</h3><p>无法连接到服务器，请检查地址是否正确</p>';
                debugDiv.innerHTML += '错误: 网络连接失败\n';
            };
            
            // 发送请求
            xhr.send();
        }
    </script>
</body>
</html>
    